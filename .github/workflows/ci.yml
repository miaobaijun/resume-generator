name: CI Pipeline
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: 检出代码
        uses: actions/checkout@v4

      - name: 安装Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: 安装依赖
        run: pip install pytest pytest-cov

      - name: 执行测试并生成覆盖率报告
        run: |  # 注意：以下内容有缩进！
          pytest tests/ --cov=src --cov-report=term --cov-report=xml:docs/coverage/coverage.xml
          mkdir -p docs/coverage
          [ -f coverage.xml ] && mv coverage.xml docs/coverage/  # 处理可能的路径差异

      - name: 上传到Coveralls
        uses: coverallsapp/github-action@v2
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          coveralls-token: ${{ secrets.COVERALLS_SECRET }}
          path-to-lcov: docs/coverage/coverage.xml

